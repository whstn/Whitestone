<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Whitestone Vaults - Performance</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #0e1117; color: #d4af37; font-family: Georgia, serif; text-align: center; margin: 0; padding: 20px; }
    h1 { color: #d4af37; }
    h3 { color: #d4af37; }
    .vault { background: #1c2526; border: 1px solid #d4af37; padding: 30px; margin: 20px auto; max-width: 900px; border-radius: 10px; }
    .metric { font-size: 1.8rem; margin: 15px 0; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #d4af37; padding: 8px; text-align: center; }
    .chart-container { width: 80%; margin: 40px auto; }
    .footer { margin-top: 50px; font-style: italic; }
  </style>
</head>
<body>
  <h1>WHITESTONE VAULTS</h1>
  <p style="color:#d4af37;">Alpha Vault • Consistency</p>

  <div class="vault" id="report">
    <p>Loading performance data...</p>
  </div>

  <script>
    fetch('cumulative_data.json')
      .then(res => res.json())
      .then(data => {
        let html = '';
        if (data.daily_entries && data.daily_entries.length > 0) {
          let latest = data.daily_entries[data.daily_entries.length - 1];
          let total_pnl = latest.cumulative_pnl || 0;
          html = `
            <p class="metric"><strong>Cumulative PnL:</strong> $${total_pnl.toFixed(2)}</p>
            <p class="metric"><strong>From Start (${data.start_date}):</strong> $${total_pnl.toFixed(2)}</p>
          `;

          // All Trades Table
          html += `
            <h3>ALL TRADES</h3>
            <table>
              <tr><th>Gross P/L</th><th># of Trades</th><th># of Contracts</th><th>Avg. Trade Time</th><th>% Profitable</th><th>Expectancy</th><th>Fees & Comm.</th><th>Total P/L</th></tr>
              <tr>
                <td>$${latest.gross_pnl.toFixed(2)}</td>
                <td>${latest.trades_count}</td>
                <td>${latest.trades_count * 2.75}</td> <!-- placeholder -->
                <td>1min 6sec</td>
                <td>${latest.win_rate.toFixed(2)}%</td>
                <td>$${latest.expectancy || 'N/A'}</td>
                <td>$${latest.fees.toFixed(2)}</td>
                <td>$${latest.net_pnl.toFixed(2)}</td>
              </tr>
            </table>
          `;

          // Profit & Losing Tables (placeholder - add real parsing later)
          html += `
            <h3>PROFIT TRADES</h3>
            <table>
              <tr><th>Total Profit</th><th># Winning</th><th>Largest Win</th><th>Avg. Win</th></tr>
              <tr><td>$2,405.00</td><td>6</td><td>$680.00</td><td>$400.83</td></tr>
            </table>

            <h3>LOSING TRADES</h3>
            <table>
              <tr><th>Total Loss</th><th># Losing</th><th>Largest Loss</th><th>Avg. Loss</th></tr>
              <tr><td>$(1,035.00)</td><td>2</td><td>$(735.00)</td><td>$(517.50)</td></tr>
            </table>
          `;

          // Charts
          let dates = data.daily_entries.map(e => e.date);
          let pnls = data.daily_entries.map(e => e.cumulative_pnl);
          let trades = data.daily_entries.map(e => e.trades_count || 0);
          html += `
            <div class="chart-container">
              <canvas id="pnlChart"></canvas>
            </div>
            <div class="chart-container">
              <canvas id="winLossPie"></canvas>
            </div>
          `;

          document.getElementById('report').innerHTML = html;

          // P&L History Chart
          const ctx = document.getElementById('pnlChart').getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: {
              labels: dates,
              datasets: [{
                label: 'Cumulative PnL ($)',
                data: pnls,
                borderColor: '#d4af37',
                tension: 0.1,
                fill: false
              }]
            },
            options: { scales: { y: { beginAtZero: true } } }
          });

          // Winning vs Losing Pie (placeholder - update with real data)
          const ctxPie = document.getElementById('winLossPie').getContext('2d');
          new Chart(ctxPie, {
            type: 'pie',
            data: {
              labels: ['Winning Trades', 'Losing Trades'],
              datasets: [{
                data: [75, 25],
                backgroundColor: ['#00ff00', '#ff0000']
              }]
            },
            options: { plugins: { legend: { position: 'bottom' } } }
          });

        } else {
          document.getElementById('report').innerHTML = '<p>No data yet — run the script.</p>';
        }
      })
      .catch(err => {
        document.getElementById('report').innerHTML = '<p style="color:red;">Failed to load data. Make sure cumulative_data.json exists and is valid JSON.</p>';
      });
  </script>

  <div class="footer"><em>Discipline is Luxury.</em></div>
</body>
</html>